name: Deploy Test on PR

on: pull_request

    
jobs:
  deploy:
    runs-on: ubuntu-18.04
    steps:
      - name: Check out repository code
        uses: actions/checkout@v2
      - name: Deploy
        run: |
          sh ./scripts/build_info.sh
          sh ./scripts/setup_apache_config.sh asm.moevm.info.conf

          # build test images
          docker-compose --project-name asmtestbuild build
          # stop and remove current containers/images
          docker-compose down --rmi local
          # rename images if ok
          docker image tag asmtestbuild_web:latest asm_web_debug_web:latest

          docker-compose up -d
      - name: Run tests
        run: curl http://127.0.0.1:80
