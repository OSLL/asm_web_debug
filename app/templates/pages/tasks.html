{% extends 'base.html' %}

{% block content %}
<style>
    .task_table{
        width: 100%;
        border-collapse: collapse;
        border-radius: 10px;
        border-style: hidden; /* hide standard table (collapsed) border */
        box-shadow: 0 0 0 2px lightblue; /* this draws the table border  */
    }
    table,td, tr, th{
        border: 2px solid lightblue;
        border-radius: 20px;
        padding: 4px;
    }
    #view_info, #edit_info{
        margin: 0;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);

        background-color: white;
        width: 40%;
        height: 90%;
        border: 2px solid lightblue;
        border-radius: 20px;
        box-shadow: 0 0 20px lightblue, inset 0 0 2px lightblue;
    }
    .close_button{
        position: relative;
        top: 4%;
        left: 96%;
        transform: translate(-50%, -50%);
        border-radius: 50%;
    }
    .view_scroll{
        display: flex;
        align-items: center;
        flex-direction: column;
        width: 100%;
        height: 100%;
        padding: 10px;
    }
    .view_content{
        display: flex;
        flex-direction: column;

        width: 100%;
        height: 91%;
        padding: 20px;
    }
</style>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>

<div class="py-5 text-center">
    <div>
        <div style="padding: 20px">
            <input id="find_id">
            <button type="button" class="btn btn-primary" style="border-radius: 20px" onclick="find_by_id({{ data }})">Find</button>
        </div>
        <table class="task_table" >
            <thead>
                <tr>
                    <th scope="col">id</th>
                    <th scope="col">Task</th>
                    <th scope="col">Difficulty</th>
                    <th scope="col">Success amount</th>
                    <th scope="col">Actions</th>
                </tr>
            </thead>
            {% for line in data %}
            <tr>
                <th>{{ line[0] }}</th>
                <td>{{ line[1] }}</td>
                <td>{{ line[2] }}</td>
                <td>x{{ line[3] }}</td>
                <td>
                    <div style="display: flex; justify-content: center; gap: 10px">
                        <button type="button" class="btn btn-primary" style="border-radius: 20px" onclick="show({{ line }})">View</button>
                        <button type="button" class="btn btn-success" style="border-radius: 20px" onclick="show_edit({{ line }})">Edit</button>
                        <form method="post" action="/tasks/remove/{{ line[0] }}">
                            <button type="submit" class="btn btn-danger" style="border-radius: 20px" >Delete</button>
                        </form>
                    </div>
                </td>
            </tr>
            {% endfor %}
            <tfoot>
                <tr>
                    <td colspan="5">
                        <button type="button" class="btn btn-secondary" style="border-radius: 20px" onclick="show_edit()">Add new</button>
                    </td>
                </tr>
            </tfoot>
        </table>
    </div>
</div>

<div id="view_info" style="display: none">
    <button class="btn btn-secondary close_button" style="font-weight: bold" onclick="hide()">X</button>
    <div class="view_content">
        <div class="overflow-auto view_scroll">
            <h1 id="task_id">#</h1>
            <h2 id="task_name" style="word-break: break-all; text-align: center"></h2>
            <h4 id="task_difficulty" style="align-self: end">Difficulty:</h4>
            <h4 id="task_success" style="align-self: end">Success amount:</h4>
            <hr></hr>
            <h3 style="align-self: start">Description</h3>
            <p id="task_description" style="width: 100%; word-break: break-all"></p>
            <h3 style="align-self: start; width: 100%; word-break: break-all">Examples</h3>
            <p id="task_examples" style="width: 100%; word-break: break-all"></p>
            <button class="btn btn-secondary " style="font-weight: bold; margin: 10px">Solve</button>
        </div>

    </div>
</div>
<div id="edit_info" style="display: none">
    <button class="btn btn-secondary close_button" style="font-weight: bold" onclick="hide_edit()">X</button>
    <div class="view_content">
        <form id="form_edit" class="overflow-auto view_scroll" method="post">
            <h1 id="edit_id" ></h1>
            <input type="text" id="edit_name" name="edit_name" style="word-break: break-all; text-align: center" required>
            <div style="align-self: end; display: flex;">
                <h4>Difficulty:</h4>
                <input id="edit_difficulty" name="edit_difficulty" type="number" min="1" max="5" required>
            </div>
            <h4 id="edit_success" style="align-self: end">Success amount: 0</h4>
            <hr></hr>
            <h3 style="align-self: start">Description</h3>
            <textarea id="edit_description" name="edit_description" style="width: 100%; height: 30%;" required></textarea>
            <h3 style="align-self: start; width: 100%; word-break: break-all">Examples</h3>
            <textarea id="edit_examples" name="edit_examples" style="width: 100%; height: 30%;" required></textarea>
            <button type="submit" class="btn btn-success " style="font-weight: bold; margin: 10px">Save</button>
        </form>
    </div>
</div>


<script>
    $( document ).ready(function() {
        console.log( "ready!" );
    });
    function hide(){
        $.ajax({
            success(){
                $("#view_info").hide()
            }
        })
    }
    function hide_edit(){
        $.ajax({
            success(){
                $("#edit_info").hide()
            }
        })
    }
    function show(line){
        $.ajax({
            success(){
                console.log(line);
                $("#task_id").text("#"+line[0])
                $("#task_name").text(line[1])
                $("#task_difficulty").text("Difficulty: "+line[2])
                $("#task_success").text("Success amount: "+line[3])
                $("#task_description").text(line[4])
                $("#task_examples").text(line[5])
                $("#view_info").show()
            }
        })
    }
    function show_edit(line=null){
        $.ajax({
            success(){
                if(line!=null) {
                    console.log(line);
                    $("#edit_id").text("#" + line[0])
                    $("#edit_name").val(line[1])
                    $("#edit_difficulty").val(line[2])
                    $("#edit_success").text("Success amount: " + line[3])
                    $("#edit_description").val(line[4])
                    $("#edit_examples").val(line[5])
                    $("#form_edit").attr("action", "/tasks/edit/" + line[0])
                }else {
                    $("#edit_id").text("")
                    $("#edit_name").val("")
                    $("#edit_difficulty").val(0)
                    $("#edit_success").text("Success amount: 0")
                    $("#edit_description").val("")
                    $("#edit_examples").val("")
                    $("#form_edit").attr("action", "/tasks/add")
                }
                $("#edit_info").show()
            }
        })
    }
    function find_by_id(data){
        $.ajax({
            success(){
                console.log(data)
                if($("#find_id").val()==""){
                    alert("Empty value!")
                    return
                }
                for(var i=0;i<data.length;i++){
                    if(data[i][0]==$("#find_id").val()){
                        console.log(data[i])
                        show(data[i]);
                        return;
                    }
                }
                alert("Task was not found!")
            }
        })
    }
</script>
{% endblock %}
